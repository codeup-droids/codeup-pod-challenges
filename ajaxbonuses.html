<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>yeah</title>
    <style>

        #jokes{
            height: 400px;
            width: 400px;
            display:flex;
            border: 10px solid brown;
            border-radius: 50%;
            margin: 10px;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #quoteContainer{
            display: flex;
        }

    </style>

</head>
<body>
<h1>Quote Tie-Fighter</h1>
<div id="quoteContainer">
    <button id="chuckJoke">chuck joke</button>
    <div id="jokes"></div>
    <button id="otherJoke">other quote</button>
</div>

<hr>

    <table class="table table-dark" id="products">
            <thead>
            <tr>
                <th>Restaurant</th>
                <th>Hours</th>
                <th>Open/Closed</th>
            </tr>
            </thead>
            <tbody id="restaurantInfo"></tbody>
    </table>

<script src="jquery.js"></script>
<script>




    $('#otherJoke').click(function() {
        $.ajax('http://quotes.stormconsultancy.co.uk/random.json').done(function (data) {
            $('#jokes').html('<h3>' + data.quote + ' -' + data.author + '</h3>')
        });
    });

    $('#chuckJoke').click(function(){
        $.ajax('http://api.icndb.com/jokes/random/').done(function(data){
            $('#jokes').html('<h3>' + data.value.joke + '</h3>')
        })
    });

    var restaurants = $.ajax('https://frest.glitch.me/restaurants');
    var isOpen = [];
    restaurants.done(function(data){
        console.log(data);
        data.forEach(function(datum, index){
            isOpen[index] = {
                "name": datum.name,
                "latlng": datum.latlng
            };
/*
            console.log(isOpen);
*/
            var today = new Date();
            var time = today.getHours();
            var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
            var day = days[today.getDay()];
            var joined = datum.operating_hours[day];
            console.log(joined);

            var split = datum.operating_hours[day].split(',');
            split = split.join();
            split = split.split('-');

            for (var i=0; i<split.length; i++){
                    if (split[i].includes('pm')) {
                        split[i] = split[i].replace(/\D/g, '');
                        split[i] = parseInt(split[i]);
                        split[i] += 1200;
                    } else {
                        split[i] = split[i].replace(/\D/g, '');
                        split[i] = parseFloat(split[i])
                        if (split[i] < 500){
                            split[i] += 2400;
                        }
                    }
            } isOpen[index].times = split;
          isOpen[index].displayTimes = joined;

            console.log(isOpen);

        }); isItOpen(isOpen, data);
    });

    function isItOpen(isOpen){
        var today = new Date();
        var time = today.getHours();
        time *= 100;
        console.log(time);
        for (var i=0; i<isOpen.length; i++){
            if (time >= isOpen[i].times[0] && time <= isOpen[i].times[1]){
                isOpen[i].open = 'Open'
            } else if (time >= isOpen[i].times[2] && time <= isOpen[i].times[3]){
                isOpen[i].open = 'Open'

            } else{
                isOpen[i].open = 'Closed'
            }
        } makeTable(isOpen);
        closeToKatz(isOpen);
/*
        console.log(isOpen)
*/
    }

    function makeTable(arr){
        arr.forEach(function(element){
            $('#restaurantInfo').append('<tr><td>' + element.name + '<td>' + element.displayTimes +'</td><td>' + element.open + '</td></tr>')
        })
    }




        function closeToKatz() {
            var katzArray = []
            isOpen.forEach(function(element){
                if (element.name !== "Katz's Delicatessen") {
                    element.distFromKatz = [(40.722216 - element.latlng.lat), (-73.987501 - element.latlng.lng)]
                    element.distFromKatz = element.distFromKatz[0] + element.distFromKatz[1]
                    katzArray.push(Math.abs(element.distFromKatz))
                }
            });
            var closest = Math.min(...katzArray);
            isOpen.forEach(function(element){
                if (closest === Math.abs(element.distFromKatz)){
                    alert(element.name + ' is the closest restaurant to Katz')
                }
            })

        }



</script>
</body>
</html>